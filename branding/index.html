<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NAKED Manufacturing — Speed Test</title>

  <link rel="stylesheet" href="naked.css">

  <!-- These exist in the container already -->
  <script src="speedtest.js"></script>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div>
        <div class="kicker">NAKED Manufacturing</div>
        <h1>Network Speed Test</h1>
        <p class="muted">Download / upload / ping test to this server.</p>
      </div>
      <div class="status" id="status">Idle</div>
    </header>

    <main class="card">
      <div class="grid">
        <div class="kpi"><div class="label">Ping</div><div class="value"><span id="ping">—</span><small> ms</small></div></div>
        <div class="kpi"><div class="label">Jitter</div><div class="value"><span id="jitter">—</span><small> ms</small></div></div>
        <div class="kpi"><div class="label">Download</div><div class="value"><span id="dl">—</span><small> Mbps</small></div></div>
        <div class="kpi"><div class="label">Upload</div><div class="value"><span id="ul">—</span><small> Mbps</small></div></div>
      </div>

      <div class="actions">
        <button class="primary" id="start">Start Test</button>
        <button id="stop" disabled>Stop</button>
        <span class="muted">Tip: wired connection for best results.</span>
      </div>
    </main>
  </div>

<script>
  const statusEl = document.getElementById("status");
  const pingEl = document.getElementById("ping");
  const jitterEl = document.getElementById("jitter");
  const dlEl = document.getElementById("dl");
  const ulEl = document.getElementById("ul");
  const startBtn = document.getElementById("start");
  const stopBtn = document.getElementById("stop");

  let st = null;

  const fmt = (x) => {
    const n = Number(x);
    return Number.isFinite(n) ? n.toFixed(2) : "—";
  };

  function setStatus(t){ statusEl.textContent = t; }

  startBtn.onclick = () => {
    if (st) return;
    st = new Speedtest();

    st.onupdate = () => {
      setStatus("Running");
      pingEl.textContent = fmt(st.getPing());
      jitterEl.textContent = fmt(st.getJitter());
      dlEl.textContent = fmt(st.getDlSpeed());
      ulEl.textContent = fmt(st.getUlSpeed());
    };

    st.onend = (aborted) => {
      setStatus(aborted ? "Stopped" : "Done");
      startBtn.disabled = false;
      stopBtn.disabled = true;
      st = null;
    };

    startBtn.disabled = true;
    stopBtn.disabled = false;
    setStatus("Starting…");
    st.start();
  };

  stopBtn.onclick = () => { if (st) st.abort(); };
</script>
</body>
</html>
